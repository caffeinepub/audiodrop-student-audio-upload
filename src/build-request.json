{
  "kind": "build_request",
  "title": "Convert in-browser recordings to MP3 (FFmpeg.wasm) on attach/submit",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "When the user clicks \"Use This Recording\" in the in-browser recorder, convert the recorded Blob to an MP3 Blob using FFmpeg.wasm at 128kbps CBR, then attach the resulting MP3 as the selected upload file.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Wire MP3 conversion ONLY for in-browser recordings.\n\n- When user clicks \"Use This Recording\" or \"Submit Recording\":\n   convert the recorded Blob to MP3 using FFmpeg.wasm at 128kbps CBR.\n- Replace the upload file with the MP3 Blob.\n- Set filename to something like: recording-<timestamp>.mp3\n- Set mimeType to audio/mpeg.\nDo not modify file-upload path yet (uploaded files can remain unchanged for now)."
        ]
      },
      "acceptanceCriteria": [
        "Clicking \"Use This Recording\" runs FFmpeg.wasm conversion on the recorder-produced Blob (not on uploaded files).",
        "After clicking \"Use This Recording\", the form's selected file is an MP3 File/Blob with MIME type exactly \"audio/mpeg\".",
        "After clicking \"Use This Recording\", the attached filename matches the pattern \"recording-<timestamp>.mp3\"."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the FFmpeg conversion helper so the produced MP3 encoding settings are 128kbps CBR (not VBR) and continue returning a Blob with MIME type \"audio/mpeg\".",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "convert the recorded Blob to MP3 using FFmpeg.wasm at 128kbps CBR.",
          "Set mimeType to audio/mpeg."
        ]
      },
      "acceptanceCriteria": [
        "The FFmpeg invocation used by the app enforces 128kbps constant bitrate output for MP3 conversion.",
        "The conversion helper returns a non-empty Blob whose type is \"audio/mpeg\"."
      ]
    },
    {
      "id": "REQ-3",
      "text": "When the user clicks \"Submit Recording\", ensure the submission uses the MP3 produced from in-browser recordings (as specified), while leaving the uploaded-file flow unchanged (uploaded files are submitted as-is).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Do not modify file-upload path yet (uploaded files can remain unchanged for now)."
        ]
      },
      "acceptanceCriteria": [
        "Submitting after attaching an in-browser recording uploads the MP3 bytes (not the original recorded container).",
        "Submitting an uploaded audio file does not trigger MP3 conversion and preserves the original file name/type behavior."
      ]
    }
  ],
  "constraints": [
    "Do not change the uploaded-file path/flow at this time; only in-browser recordings are converted to MP3.",
    "Do not add backend changes for this request (no Motoko API/schema changes).",
    "Do not edit frontend files in immutablePaths (e.g., frontend/src/hooks/useActor.ts, frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/main.tsx, or frontend/src/components/ui/*)."
  ],
  "nonGoals": [
    "Server-side audio conversion.",
    "Converting user-uploaded files to MP3.",
    "Changing validation rules, size limits, or submission metadata beyond filename/mimeType for converted in-browser recordings."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}